<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>spark.spec-tacular documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Spec-tacular</span> <span class="project-version">0.6.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spark</span></div></div></li><li class="depth-2 current"><a href="spark.spec-tacular.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec-tacular</span></div></a></li><li class="depth-3 branch"><a href="spark.spec-tacular.datomic.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datomic</span></div></a></li><li class="depth-3 branch"><a href="spark.spec-tacular.generators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generators</span></div></a></li><li class="depth-3"><a href="spark.spec-tacular.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="spark.spec-tacular.html#var-check-component.21"><div class="inner"><span>check-component!</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-coerce"><div class="inner"><span>coerce</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-database-coercion"><div class="inner"><span>database-coercion</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-defenum"><div class="inner"><span>defenum</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-defspec"><div class="inner"><span>defspec</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-defunion"><div class="inner"><span>defunion</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-diff"><div class="inner"><span>diff</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-get-spec"><div class="inner"><span>get-spec</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-get-type"><div class="inner"><span>get-type</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-has-spec.3F"><div class="inner"><span>has-spec?</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-identical-keys"><div class="inner"><span>identical-keys</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-Item"><div class="inner"><span>Item</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-namespace-.3Especs"><div class="inner"><span>namespace-&gt;specs</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-primitive.3F"><div class="inner"><span>primitive?</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-recursiveness"><div class="inner"><span>recursiveness</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-refless"><div class="inner"><span>refless</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-refless.3D"><div class="inner"><span>refless=</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-spec-meta"><div class="inner"><span>spec-meta</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-SpecInstance"><div class="inner"><span>SpecInstance</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-SpecName"><div class="inner"><span>SpecName</span></div></a></li><li class="depth-1"><a href="spark.spec-tacular.html#var-SpecT"><div class="inner"><span>SpecT</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">spark.spec-tacular</h1><div class="doc"><div class="markdown"><p>A database-agnostic DSL for data specifications</p></div></div><div class="public anchor" id="var-check-component.21"><h3>check-component!</h3><div class="usage"><code>(check-component! spec k v)</code></div><div class="doc"><div class="markdown"><p>Checks the field name <code>k</code> and its value <code>v</code> against the given spec, errors if <code>v</code> is not of the correct type. Returns <code>true</code> otherwise.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L168">view source</a></div></div><div class="public anchor" id="var-coerce"><h3>coerce</h3><div class="usage"><code>(coerce spec kw val)</code></div><div class="doc"><div class="markdown"><p>Coerces <code>val</code> into something that could be put in the <code>kw</code> field of <code>spec</code>. Returns <code>nil</code> only if the value is coerced to <code>nil</code>; i.e. if <code>val</code> does not have a <code>coercion</code> the <code>val</code> is returned unharmed.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L132">view source</a></div></div><div class="public anchor" id="var-database-coercion"><h3>database-coercion</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Returns the coercion function that maps an object of a known database type (currently <code>datomic.query.EntityMap</code>) to a map that can be used in a spec constructor. Defaults to <code>nil</code> if the object does not come from a known database type.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L92">view source</a></div></div><div class="public anchor" id="var-defenum"><h3>defenum</h3><h4 class="type">macro</h4><h4 class="added">added in 0.6.0</h4><div class="usage"><code>(defenum &amp; stx)</code></div><div class="doc"><div class="markdown"><p>Defines an enumeration of values under a parent name.</p>
<pre><code>(defenum Name docstring? symbol ...)
</code></pre>
<p>The resulting enumeration recognizes <code>:Name/&lt;symbol&gt;</code> keywords, which answer <code>true</code> to <code>name?</code>. Enumerations do not define constructors as keywords are already Clojure values.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L698">view source</a></div></div><div class="public anchor" id="var-defspec"><h3>defspec</h3><h4 class="type">macro</h4><div class="usage"><code>(defspec &amp; stx)</code></div><div class="doc"><div class="markdown"><p>Defines a spec-tacular spec type.</p>
<pre><code>(defspec Name
  docstring?
  [field-name arity type option ...]
  ...)
</code></pre>
<p>creates the spec <code>:Name</code>; where arity is either <code>:is-a</code> or <code>:is-many</code> and type is either another spec name or a primitive type keyword. The docstring is optional; if given, it will become the :doc metadata on the spec var.</p>
<p>spec-tacular supports base types <code>:keyword</code>, <code>:string</code>, <code>:boolean</code>, <code>:long</code>, <code>:bigint</code>, <code>:float</code>, <code>:double</code>, <code>:bigdec</code>, <code>:instant</code>, <code>:calendarday</code>, <code>:uuid</code>, <code>:uri</code>, and <code>:bytes</code>.</p>
<p>Fields are allowed to have the following options:</p>
<ul>
  <li><code>:unique</code> and <code>:identity</code>, meaning only one entity can have a given value for this attribute in the database</li>
  <li><code>:link</code>, meaning the instance is always passed by-reference</li>
  <li><code>:component</code>, mutually exclusive with <code>:link</code>, means the instance only exists when tied to it&rsquo;s parent</li>
  <li><code>:required</code>, a required field</li>
</ul>
<p>A core.typed alias <code>Name</code> is created, as well as a constructor <code>name</code> and a predicate <code>name?</code>.</p>
<p>Spec instances that are created from a database may also contain the <code>:db-ref</code> field which, in the case of Datomic, contains a map <code>{:eid
database-id}</code> containing the entity&rsquo;s <code>:db/id</code>.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L629">view source</a></div></div><div class="public anchor" id="var-defunion"><h3>defunion</h3><h4 class="type">macro</h4><div class="usage"><code>(defunion &amp; stx)</code></div><div class="doc"><div class="markdown"><p>Defines a spec-tacular union.</p>
<pre><code>(defunion Name docstring? :SpecName ...)
</code></pre>
<p>where each SpecName is another spec to be added to the union.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L678">view source</a></div></div><div class="public anchor" id="var-diff"><h3>diff</h3><div class="usage"><code>(diff sp1 sp2)</code></div><div class="doc"><div class="markdown"><p>Takes two spec instances and returns a vector of three maps created by calling <code>clojure.data/diff</code> on each item of the spec.</p>
<p>Only well defined when <code>sp1</code> and <code>sp2</code> share the same spec.</p>
<p>For <code>:is-many</code> fields, expect to see sets of similarities or differences in the result, as order should not matter.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L724">view source</a></div></div><div class="public anchor" id="var-get-spec"><h3>get-spec</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Acts like the identity function if sent an actual spec object.</p>
<p>Otherwise, if there is a spec (defined with <a href="spark.spec-tacular.html#var-defspec">defspec</a>, <a href="spark.spec-tacular.html#var-defunion">defunion</a>, or <a href="spark.spec-tacular.html#var-defenum">defenum</a>) such that:</p>
<ul>
  <li>the spec has the <code>:name</code> denoted by the argument, when given a keyword;</li>
  <li>the spec instance is an instance of that spec, when given an actual spec instance;</li>
</ul>
<p>then returns that spec, otherwise returns <code>nil</code>.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L53">view source</a></div></div><div class="public anchor" id="var-get-type"><h3>get-type</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Returns a <a href="null">SpecType</a> record containing the <code>name</code> of the type, the class <code>type</code>, a symbol <code>type-symbol</code> that would eval to the <code>type</code> (useful for macros), and possibly a <code>coercion</code> function.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L70">view source</a></div></div><div class="public anchor" id="var-has-spec.3F"><h3>has-spec?</h3><div class="usage"><code>(has-spec? o)</code></div><div class="doc"><div class="markdown"><p>Returns whether or not the given object has a spec.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L146">view source</a></div></div><div class="public anchor" id="var-identical-keys"><h3>identical-keys</h3><div class="usage"><code>(identical-keys si)</code></div><div class="doc"><div class="markdown"><p>Takes any number of spec instances and returns the keys for fields with values they all share in common. Useful for error messages.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L751">view source</a></div></div><div class="public anchor" id="var-Item"><h3>Item</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The type of a field in a spec</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L29">view source</a></div></div><div class="public anchor" id="var-namespace-.3Especs"><h3>namespace-&gt;specs</h3><div class="usage"><code>(namespace-&gt;specs namespace)</code></div><div class="doc"><div class="markdown"><p>Returns a sequence containing every spec in the given namespace.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L152">view source</a></div></div><div class="public anchor" id="var-primitive.3F"><h3>primitive?</h3><div class="usage"><code>(primitive? spec-name)</code></div><div class="doc"><div class="markdown"><p>Returns <code>true</code> if the given spec name is primitive (i.e. is part of the base type environment and not defined as a spec), <code>false</code> otherwise. See <a href="spark.spec-tacular.html#var-defspec">defspec</a> for a list of primitive type keywords.</p>
<p>Note that all specs defined by <code>defenum</code> are considered primitive, since their values are all keywords.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L114">view source</a></div></div><div class="public anchor" id="var-recursiveness"><h3>recursiveness</h3><div class="usage"><code>(recursiveness {[_ t] :type})</code></div><div class="doc"><div class="markdown"><p>Returns <code>:non-rec</code> if the given item is <a href="spark.spec-tacular.html#var-primitive.3F">primitive?</a>, <code>:rec</code> otherwise.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L127">view source</a></div></div><div class="public anchor" id="var-refless"><h3>refless</h3><h4 class="added">added in 0.5.0</h4><div class="usage"><code>(refless si)</code></div><div class="doc"><div class="markdown"><p>Returns a version of the given spec instance with no <code>:db-ref</code>s on any sub-instance.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L763">view source</a></div></div><div class="public anchor" id="var-refless.3D"><h3>refless=</h3><h4 class="added">added in 0.5.0</h4><div class="usage"><code>(refless= x y)</code></div><div class="doc"><div class="markdown"><p>Given any walkable collection, returns <code>true</code> if the two collections would be <code>=</code> if no spec instances had <code>:db-ref</code>s.</p>
<p>Contains a fast path if both <code>x</code> and <code>y</code> have specs, otherwise expect bad asymptotics as each collection must be rebuilt without <code>:db-ref</code>s.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L785">view source</a></div></div><div class="public anchor" id="var-spec-meta"><h3>spec-meta</h3><h4 class="added">added in 0.6.0</h4><div class="usage"><code>(spec-meta ns spec spec-meta)</code></div><div class="doc"><div class="markdown"><p>Parses the meta-data that can be placed on a namespace containing spec definitions, or on spec definitions themselves. Not intended to be called directly.</p>
<p>Currently, it is possible to override the constructor, predicate, and type aliases name for a single spec or all specs in a namespace.</p>
<pre><code>(ns my-ns
 {....
  :spec-tacular
  {:ctor-name-fn  (fn [s] ....)
   :huh-name-fn   (fn [s] ....)
   :alias-name-fn (fn [s] ....)}
  ....}
  (:require ....))
</code></pre>
<p>Each function should expect a string and return a string. The function is currently <code>eval</code>uated in the <a href="spark.spec-tacular.html">spark.spec-tacular</a> namespace, so plan accordingly.</p>
<p>These names can be overriden on a per-spec basis in a similar fashion.</p>
<pre><code>(defspec
  ^{:ctor-name  &quot;mk-my-spec&quot;
    :huh-name   false ;; fall back to default
    :alias-name &quot;my-spec-type&quot;}
  my-spec
  ....)
</code></pre>
<p>The spec-level meta-data has higher priority than the namespace-level meta-data.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L566">view source</a></div></div><div class="public anchor" id="var-SpecInstance"><h3>SpecInstance</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The broadest type for a spec instance, but it is preferable to use an alias defined via <a href="spark.spec-tacular.html#var-defspec">defspec</a>.</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L20">view source</a></div></div><div class="public anchor" id="var-SpecName"><h3>SpecName</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The type of the <code>:name</code> field of a spec</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L25">view source</a></div></div><div class="public anchor" id="var-SpecT"><h3>SpecT</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The type of a spec</p></div></div><div class="src-link"><a href="https://github.com/SparkFund/spec-tacular/blob/develop/src/spark/spec_tacular.clj#L34">view source</a></div></div></div></body></html>